import{v as e}from"./vuedraggable.umd.f2c62cd6.js";import{u as s,s as a,r as t,v as l,a as i,w as d,x as o,b as n,o as u,g as r,n as c,c as v,f,y as p,t as m,z as y,k as h,m as k,F as w,B as C,C as b,D as _,E as I,G as E,H as S,p as g,q as x}from"./index.4bf722b3.js";import{u as L,z as U,a as A}from"./useExcel.35fcdafa.js";import{_ as j}from"./index.bfe593bd.js";const q=e=>(g("data-v-7134f358"),e=e(),x(),e),N={class:"minions-content"},B={class:"minions-left"},P={class:"left-head"},z=q((()=>c("h6",null,"行业概念",-1))),D={class:"left-body"},T=["onClick"],$={key:0,class:"icon-close"},F={class:"minions-right"},G={class:"right-head"},H={class:"right-body"},K=q((()=>c("a",null,"删除",-1))),M=q((()=>c("div",{class:"info-header"},"新增行业概念",-1))),Y={class:"info-content"},Z=q((()=>c("div",{class:"info-header"},"新增股票",-1))),J={class:"info-content"};var O=j({__name:"stockConcept",setup(g){const x=s(),{columns:j,searchStockList:q,onCodeChange:O,onAddZcwStock:Q,stocksList:R,zcwlist:V,onBuyPriceBlur:W,onEditStock:X}=L(),ee=a({isEditIndustry:!1,industryCheckedId:"",list:[],addIndustryName:"",isAddIndustryShow:!1,isEditShow:!1,stocksCodeList:[]}),se={code:"",buyPrice:"",stopSurplus:"",stopLoss:"",house:"",name:"",isExist:"",industry:""},ae=t(l(se)),te=i((()=>l(ee.list).sort(((e,s)=>e.sort-s.sort)))),le=async()=>{const{errcode:e,data:s}=await C({});0==e&&(ee.list=s,ee.list.length>0&&!ee.industryCheckedId&&b((()=>{ee.industryCheckedId=te.value[0].id})))},ie=async e=>{ee.list=l(te.value).map(((e,s)=>(e.sort=s,e)));const s={list:ee.list};await _(s)},de=i((()=>ee.list.find((e=>e.id==ee.industryCheckedId))||{})),oe=i((()=>{var e;return((null==(e=de.value)?void 0:e.stocks)||"").split(",").filter((e=>e))}));d((()=>oe.value),(e=>{e.length>0?q(e):V.value=[]}),{deep:!0});const ne=async()=>{const{code:e,name:s,isExist:a}=ae.value;if(6!=e.length)return void I.warn("请输入正确的股票代码");if(oe.value.includes(e))return void I.warn("股票已存在");if(a){if(!(await X(ae.value)))return void I.error("修改股票失败")}else{if(!(await Q(ae.value)))return void I.error("新增股票失败")}const t=[e,...oe.value],i=l(de.value);i.stocks=t.join(",");const d={list:[i]},{errcode:o,data:n}=await _(d);0==o&&(I.success("新增成功"),ee.isEditShow=!1,ae.value=l(se),le())},ue=async()=>{const e={sort:ee.list.length,name:ee.addIndustryName},{errcode:s,data:a}=await E(e);0==s&&(ee.list=a,ee.isAddIndustryShow=!1,ee.addIndustryName="")},{exportEecel:re}=A(),ce=()=>{const{name:e}=de.value;re(R.value,j,`${e}_${x.getters.getYMDate}`)};return o((()=>{le()})),(s,a)=>{const t=n("a-button"),i=n("a-popconfirm"),d=n("a-input"),o=n("a-form-item"),C=n("a-form"),b=n("a-modal"),E=n("a-input-number");return u(),r(w,null,[c("div",N,[c("div",B,[c("div",P,[z,v(t,{onClick:a[0]||(a[0]=e=>ee.isEditIndustry=!ee.isEditIndustry)},{default:f((()=>[p(m(ee.isEditIndustry?"确定":"编辑"),1)])),_:1})]),c("div",D,[v(k(e),{list:te.value,"ghost-class":"ghost","chosen-class":"chosenClass",animation:"300",itemKey:"id",onUpdate:ie},{item:f((({element:e,index:s})=>[c("div",{class:y(["left-li",{s:ee.industryCheckedId==e.id}]),onClick:s=>ee.industryCheckedId=e.id},[c("span",null,m(e.name),1),v(i,{title:"确定要删除这个行业概念?",onConfirm:s=>(async e=>{const{errcode:s,data:a}=await S({id:e});0==s&&(ee.list=a,ee.list.length>0&&e==ee.industryCheckedId&&(ee.industryCheckedId=ee.list[0].id))})(e.id)},{default:f((()=>[ee.isEditIndustry?(u(),r("div",$)):h("",!0)])),_:2},1032,["onConfirm"])],10,T)])),_:1},8,["list"]),ee.isEditIndustry?(u(),r("div",{key:0,class:"left-li-add-btn",onClick:a[1]||(a[1]=e=>ee.isAddIndustryShow=!0)}," 新增 ")):h("",!0)])]),c("div",F,[c("div",G,[v(t,{type:"primary",onClick:a[2]||(a[2]=e=>k(q)(oe.value))},{default:f((()=>[p("刷新")])),_:1}),v(t,{onClick:ce},{default:f((()=>[p("导出")])),_:1}),v(t,{type:"primary",onClick:a[3]||(a[3]=e=>ee.isEditShow=!0)},{default:f((()=>[p("新增")])),_:1})]),c("div",H,[v(U,{columns:k(j),stocksList:k(R)},{default:f((e=>[v(i,{title:"确定要删除这个股票?",onConfirm:s=>(async e=>{const s=l(oe.value).filter((s=>s!=e)),a=l(de.value);a.stocks=s.join(",");const t={list:[a]},{errcode:i,data:d}=await _(t);0==i&&(I.success("删除成功"),le())})(e.record.code)},{default:f((()=>[K])),_:2},1032,["onConfirm"])])),_:1},8,["columns","stocksList"])])])]),v(b,{class:"infoTips",visible:ee.isAddIndustryShow,"onUpdate:visible":a[6]||(a[6]=e=>ee.isAddIndustryShow=e),width:"400px"},{title:f((()=>[M])),footer:f((()=>[v(t,{onClick:a[5]||(a[5]=e=>ee.isAddIndustryShow=!1)},{default:f((()=>[p("取消")])),_:1}),v(t,{type:"primary",onClick:ue},{default:f((()=>[p("确定")])),_:1})])),default:f((()=>[c("div",Y,[v(C,{model:ae.value,"label-col":{span:6},"wrapper-col":{span:18},autocomplete:"off"},{default:f((()=>[v(o,{label:"行业概念",rules:[{required:!0}]},{default:f((()=>[v(d,{value:ee.addIndustryName,"onUpdate:value":a[4]||(a[4]=e=>ee.addIndustryName=e),placeholder:"行业概念"},null,8,["value"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),v(b,{class:"infoTips",visible:ee.isEditShow,"onUpdate:visible":a[14]||(a[14]=e=>ee.isEditShow=e),width:"400px",onCancel:a[15]||(a[15]=e=>ee.isEditShow=!1)},{title:f((()=>[Z])),footer:f((()=>[v(t,{onClick:a[13]||(a[13]=e=>ee.isEditShow=!1)},{default:f((()=>[p("取消")])),_:1}),v(t,{type:"primary",onClick:ne},{default:f((()=>[p("确定")])),_:1})])),default:f((()=>[c("div",J,[v(C,{model:ae.value,"label-col":{span:6},"wrapper-col":{span:18},autocomplete:"off"},{default:f((()=>[v(o,{label:"股票代码",rules:[{required:!0}]},{default:f((()=>[v(d,{value:ae.value.code,"onUpdate:value":a[7]||(a[7]=e=>ae.value.code=e),style:{width:"35%"},placeholder:"股票代码",onChange:a[8]||(a[8]=e=>k(O)(ae.value))},null,8,["value"]),p("   "),c("span",null,m(ae.value.name)+m(ae.value.industry),1)])),_:1}),v(o,{label:"买入价",rules:[{required:!0}]},{default:f((()=>[v(E,{value:ae.value.buyPrice,"onUpdate:value":a[9]||(a[9]=e=>ae.value.buyPrice=e),min:0,placeholder:"请输入股票买入价格",onBlur:a[10]||(a[10]=e=>k(W)(ae.value))},null,8,["value"])])),_:1}),v(o,{label:"止盈",rules:[{required:!0}]},{default:f((()=>[v(E,{value:ae.value.stopSurplus,"onUpdate:value":a[11]||(a[11]=e=>ae.value.stopSurplus=e),min:0,placeholder:"请输入股票止盈价格"},null,8,["value"])])),_:1}),v(o,{label:"止损",rules:[{required:!0}]},{default:f((()=>[v(E,{value:ae.value.stopLoss,"onUpdate:value":a[12]||(a[12]=e=>ae.value.stopLoss=e),min:0,placeholder:"请输入股票止损价格"},null,8,["value"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"])],64)}}},[["__scopeId","data-v-7134f358"]]);export{O as default};
