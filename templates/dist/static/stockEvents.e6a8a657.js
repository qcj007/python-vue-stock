import{u as e,s as a,a as t,v as s,w as l,x as n,b_ as i,r as u,b as o,o as r,g as d,n as c,c as v,f as m,y as p,m as f,t as T,F as b,b$ as k,c0 as x,E as y,c1 as h,c2 as Y}from"./index.4bf722b3.js";import{c as M,b as g,u as L,z as _,a as R}from"./useExcel.35fcdafa.js";import"./index.bfe593bd.js";const $={class:"minions-content"},w={class:"minions-head"},D=c("div",null,null,-1),S={class:"btn-cont"},C={class:"minions-body"},I=["onClick"],E=c("a",null,"删除",-1),z=c("div",{class:"info-header"},"新增股票",-1),H={class:"info-content"},P={__name:"stockEvents",setup(P){const U=e(),q=u(!1),j={code:"",house:"",name:"",industry:"",eventTime:"",stockTime:[],eventRemark:"",buyPrice:"",stopSurplus:"",stopLoss:"",isExist:!1},B=u(s(j)),{columns:A,state:F,searchStockList:Z,stocksList:G}=(()=>{const u=e(),o=[{title:"序号",dataIndex:"index",key:"index",width:60,align:"center",customRender:({text:e,record:a,index:t})=>`${t+1}`},{title:"股票代码",dataIndex:"code"},{title:"股票名称",dataIndex:"name"},{title:"现价(元)",dataIndex:"price"},{...g("涨跌幅","zdf",(e=>{const a=1*e.zdf;return{innerHTML:`<span class="${a<0?"green":"red"}">${a}%</span>`}}))},{...g("换手率","hsl",(e=>({innerHTML:`<span class="blue">${e.hsl}%</span>`})))},{...g("量比","lb")},{...g("赔率","oddsRate",(e=>{const a=1*e.oddsRate;return{innerHTML:`<span class="${a<0?"green":"red"}">${a}%</span>`}}))},{title:"买入价(元)",dataIndex:"buyPrice"},{...g("距离买入价","buyRate",(e=>{const a=e.buyRate;return{innerHTML:`<span class="${a<5?"red":a<10?"blue":""}">${a}%</span>`}}))},{title:"止盈(元)",dataIndex:"stopSurplus"},{title:"止损(元)",dataIndex:"stopLoss"},{title:"事件备注",dataIndex:"eventRemark"},{title:"事件时间",dataIndex:"eventTime"},{title:"股票开始时间",dataIndex:"startTime"},{title:"股票结束时间",dataIndex:"endTime"},{...g("距离开始时间","distanceStartTime",(e=>{const{distanceStartTime:a,distanceEndTime:t}=e;let s=`${a}天`,l="";return a<=0&&t>0?(s="已开始",l="red"):t<=0&&(s="已结束",l="green"),{innerHTML:`<span class="${l}">${s}</span>`}}))},{...g("距离结束时间","distanceEndTime",(e=>{const{distanceStartTime:a,distanceEndTime:t}=e;let s=`${t}天`,l="";return a<=0&&t>0?l="blue":t<=0&&(s="已结束",l="green"),{innerHTML:`<span class="${l}">${s}</span>`}}))},{...g("市盈率","syl")},{...g("市净率","sjl")},{...g("流通市值","ltsz",(e=>({innerHTML:`${e.ltsz}亿`})))},{...g("总市值","zsz",(e=>({innerHTML:`${e.zsz}亿`})))},{title:"操作",dataIndex:"operation"}],r=a({dataIndex:"",list:[]}),d=async()=>{r.list=[];const{errcode:e,data:a}=await i({});0==e&&(a.reverse(),r.list=a,console.log(r.list))},c=(new Date).getTime(),v=t((()=>s(r.list).map((e=>{const{price:a,buyPrice:t,stopSurplus:s,startTime:l,eventTime:n,endTime:i}=e,{buyRate:o,oddsRate:r}=M(a,t,s,u.getters.offset);return e.buyRate=o,e.oddsRate=r,e.distanceStartTime=Math.ceil((new Date(l).getTime()-c)/1e3/60/60/24),e.distanceEndTime=Math.ceil((new Date(i).getTime()-c)/1e3/60/60/24),e}))));return l((()=>v.value),(()=>{console.log(v.value)}),{deep:!0}),n((()=>{d()})),{columns:o,state:r,searchStockList:d,stocksList:v}})(),{onCodeChange:J,onAddZcwStock:K,onBuyPriceBlur:N,onEditStock:O}=L(),{exportEecel:Q}=R(),V=u({}),W=()=>{Q(G.value,A,`支撑位_${U.getters.getYMDate}`)},X=async()=>{const{stockTime:e,eventTime:a,code:t,house:l,name:n,eventRemark:i,isExist:u}=B.value;if(6!=t.length)return void y.warn("请输入正确的股票代码");const{id:o}=V.value;if(u||o){if(!(await O(B.value)))return void y.error("修改股票失败")}else{if(!(await K(B.value)))return void y.error("新增支撑位股票失败")}const r={id:o,code:t,house:l,name:n,eventRemark:i,startTime:k(e[0]).format("YYYY-MM-DD"),endTime:k(e[1]).format("YYYY-MM-DD"),eventTime:k(a).format("YYYY-MM-DD")},d=o?h:Y,{errcode:c,data:v}=await d(r);0==c&&(y.success((o?"修改":"新增")+"成功"),q.value=!1,Z(),V.value={},B.value=s(j))},ee=()=>{q.value=!1;const{id:e}=V.value;e&&(V.value={},B.value=s(j))};return(e,a)=>{const t=o("a-button"),s=o("a-popconfirm"),l=o("a-input"),n=o("a-form-item"),i=o("a-input-number"),u=o("a-date-picker"),h=o("a-range-picker"),Y=o("a-textarea"),M=o("a-form"),g=o("a-modal");return r(),d(b,null,[c("div",$,[c("div",w,[D,c("div",S,[v(t,{onClick:a[0]||(a[0]=e=>q.value=!0)},{default:m((()=>[p("新增")])),_:1}),v(t,{onClick:W},{default:m((()=>[p("导出")])),_:1}),v(t,{type:"primary",onClick:f(Z)},{default:m((()=>[p("刷新")])),_:1},8,["onClick"])])]),c("div",C,[v(_,{columns:f(A),stocksList:f(G)},{default:m((e=>[c("a",{onClick:a=>(e=>{const{code:a,house:t,name:s,eventTime:l,eventRemark:n,startTime:i,endTime:u,buyPrice:o,stopSurplus:r,stopLoss:d}=e;V.value=e,B.value={code:a,house:t,name:s,eventRemark:n,eventTime:k(l,"YYYY-MM-DD"),stockTime:[k(i,"YYYY-MM-DD"),k(u,"YYYY-MM-DD")],buyPrice:o,stopSurplus:r,stopLoss:d,isExist:!0},q.value=!0})(e.record),style:{"margin-right":"10px"}},"编辑",8,I),v(s,{title:"确定要删除这个股票?",onConfirm:a=>(async e=>{const a={list:[e]},{errcode:t,data:s}=await x(a);0==t&&(y.success("删除成功"),F.list=F.list.filter((a=>e!==a.id)))})(e.record.id)},{default:m((()=>[E])),_:2},1032,["onConfirm"])])),_:1},8,["columns","stocksList"])])]),v(g,{class:"infoTips",visible:q.value,"onUpdate:visible":a[10]||(a[10]=e=>q.value=e),width:"400px",onCancel:a[11]||(a[11]=e=>q.value=!1)},{title:m((()=>[z])),footer:m((()=>[v(t,{onClick:ee},{default:m((()=>[p("取消")])),_:1}),v(t,{type:"primary",onClick:X},{default:m((()=>[p("确定")])),_:1})])),default:m((()=>[c("div",H,[v(M,{model:B.value,"label-col":{span:6},"wrapper-col":{span:18},autocomplete:"off"},{default:m((()=>[v(n,{label:"股票代码",rules:[{required:!0}]},{default:m((()=>[v(l,{value:B.value.code,"onUpdate:value":a[1]||(a[1]=e=>B.value.code=e),style:{width:"35%"},placeholder:"股票代码",onChange:a[2]||(a[2]=e=>f(J)(B.value))},null,8,["value"]),p("   "),c("span",null,T(B.value.name)+T(B.value.industry),1)])),_:1}),v(n,{label:"买入价",rules:[{required:!0}]},{default:m((()=>[v(i,{value:B.value.buyPrice,"onUpdate:value":a[3]||(a[3]=e=>B.value.buyPrice=e),min:0,placeholder:"请输入股票买入价格",onBlur:a[4]||(a[4]=e=>f(N)(B.value))},null,8,["value"])])),_:1}),v(n,{label:"止盈",rules:[{required:!0}]},{default:m((()=>[v(i,{value:B.value.stopSurplus,"onUpdate:value":a[5]||(a[5]=e=>B.value.stopSurplus=e),min:0,placeholder:"请输入股票止盈价格"},null,8,["value"])])),_:1}),v(n,{label:"止损",rules:[{required:!0}]},{default:m((()=>[v(i,{value:B.value.stopLoss,"onUpdate:value":a[6]||(a[6]=e=>B.value.stopLoss=e),min:0,placeholder:"请输入股票止损价格"},null,8,["value"])])),_:1}),v(n,{label:"事件时间",rules:[{required:!0}]},{default:m((()=>[v(u,{value:B.value.eventTime,"onUpdate:value":a[7]||(a[7]=e=>B.value.eventTime=e)},null,8,["value"])])),_:1}),v(n,{label:"股票时间",rules:[{required:!0}]},{default:m((()=>[v(h,{value:B.value.stockTime,"onUpdate:value":a[8]||(a[8]=e=>B.value.stockTime=e)},null,8,["value"])])),_:1}),v(n,{label:"事件备注",rules:[{required:!0}]},{default:m((()=>[v(Y,{value:B.value.eventRemark,"onUpdate:value":a[9]||(a[9]=e=>B.value.eventRemark=e),placeholder:"输入事件备注","auto-size":{minRows:2,maxRows:5}},null,8,["value"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"])],64)}}};export{P as default};
